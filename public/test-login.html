<!DOCTYPE html>
<html>
<head>
    <title>Quick Login Test</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; max-width: 600px; margin: 0 auto; }
        .result { margin: 10px 0; padding: 10px; border-radius: 5px; }
        .success { background-color: #d4edda; border: 1px solid #c3e6cb; color: #155724; }
        .error { background-color: #f8d7da; border: 1px solid #f5c6cb; color: #721c24; }
        .info { background-color: #d1ecf1; border: 1px solid #bee5eb; color: #0c5460; }
        button { padding: 10px 20px; margin: 5px; cursor: pointer; }
        input { padding: 8px; margin: 5px; width: 300px; }
    </style>
</head>
<body>
    <h1>üîç Quick Login Test for harshjeswani30@gmail.com</h1>
    
    <div>
        <input type="email" id="email" value="harshjeswani30@gmail.com" placeholder="Email">
        <br>
        <input type="password" id="password" placeholder="Enter your password">
        <br>
        <button onclick="testLogin()">Test Login</button>
        <button onclick="checkAccount()">Check Account Status</button>
        <button onclick="trySignup()">Try Signup</button>
    </div>

    <div id="results"></div>

    <script type="module">
        // Import Supabase client
        import { createClient } from 'https://cdn.skypack.dev/@supabase/supabase-js';
        
        const supabaseUrl = 'https://qmidstrenrdbjdgyiayu.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFtaWRzdHJlbnJkYmpkZ3lpYXl1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTgyMDE1NTUsImV4cCI6MjA3Mzc3NzU1NX0.viOQmAnpDoUQKEOPU32pgYY0Lp961rvDCeO2D_pziuU';
        const supabase = createClient(supabaseUrl, supabaseKey);

        window.addResult = function(title, data, type = 'info') {
            const results = document.getElementById('results');
            const div = document.createElement('div');
            div.className = `result ${type}`;
            div.innerHTML = `<strong>${title}</strong><br><pre>${JSON.stringify(data, null, 2)}</pre>`;
            results.appendChild(div);
        }

        window.testLogin = async function() {
            document.getElementById('results').innerHTML = '';
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;

            if (!password) {
                addResult('‚ùå Error', 'Please enter your password', 'error');
                return;
            }

            addResult('üîê Testing Login', { email }, 'info');

            try {
                const { data, error } = await supabase.auth.signInWithPassword({
                    email: email.toLowerCase(),
                    password: password
                });

                if (error) {
                    addResult('‚ùå Login Failed', {
                        error: error.message,
                        status: error.status
                    }, 'error');

                    // Specific guidance
                    const errorMsg = error.message.toLowerCase();
                    if (errorMsg.includes('invalid login credentials')) {
                        addResult('üîç Diagnosis', 'This usually means: 1) Wrong password, OR 2) Email not verified', 'info');
                    } else if (errorMsg.includes('email not confirmed')) {
                        addResult('üîç Diagnosis', 'Your email needs to be verified first', 'info');
                    }
                } else {
                    addResult('‚úÖ Login Successful!', {
                        user_id: data.user?.id,
                        email: data.user?.email,
                        email_confirmed: !!data.user?.email_confirmed_at
                    }, 'success');
                    
                    // Logout for testing
                    await supabase.auth.signOut();
                    addResult('‚ÑπÔ∏è Logged out for testing', {}, 'info');
                }
            } catch (err) {
                addResult('üí• Unexpected Error', err.message, 'error');
            }
        }

        window.checkAccount = async function() {
            const email = document.getElementById('email').value;
            addResult('üîç Checking Account Status', { email }, 'info');

            try {
                // Check profiles table
                const { data: profile, error: profileError } = await supabase
                    .from('profiles')
                    .select('*')
                    .eq('email', email.toLowerCase())
                    .maybeSingle();

                if (profile) {
                    addResult('‚úÖ Profile Found', {
                        id: profile.id,
                        verified: profile.verified,
                        email: profile.email,
                        full_name: profile.full_name
                    }, 'success');
                } else {
                    addResult('‚ùå No Profile Found', profileError, 'error');
                }

                // Test resend to check verification status
                const { data: resendData, error: resendError } = await supabase.auth.resend({
                    type: 'signup',
                    email: email.toLowerCase()
                });

                if (resendError) {
                    const resendMsg = resendError.message.toLowerCase();
                    if (resendMsg.includes('already confirmed')) {
                        addResult('‚úÖ Email Verified', 'Your email is confirmed - try login again', 'success');
                    } else if (resendMsg.includes('user not found')) {
                        addResult('‚ùå No Account', 'You need to sign up first', 'error');
                    } else {
                        addResult('‚ùì Resend Error', resendError.message, 'error');
                    }
                } else {
                    addResult('üìß Verification Email Sent', 'Check your inbox', 'success');
                }
            } catch (err) {
                addResult('üí• Check Failed', err.message, 'error');
            }
        }

        window.trySignup = async function() {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;

            if (!password) {
                addResult('‚ùå Error', 'Please enter a password', 'error');
                return;
            }

            addResult('üìù Attempting Signup', { email }, 'info');

            try {
                const { data, error } = await supabase.auth.signUp({
                    email: email.toLowerCase(),
                    password: password,
                    options: {
                        data: {
                            full_name: 'Harsh Jeswani',
                            role: 'alumni'
                        }
                    }
                });

                if (error) {
                    addResult('‚ùå Signup Failed', error.message, 'error');
                } else {
                    addResult('‚úÖ Signup Successful', 'Check email for verification link', 'success');
                }
            } catch (err) {
                addResult('üí• Signup Error', err.message, 'error');
            }
        }
    </script>
</body>
</html>